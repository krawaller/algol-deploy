(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[7],{"+zLY":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("p0Uh"),o=n("iHP3"),a=function(e){return{key:"game-main-".concat(e.id),me:Object(r.a)(e),crumbs:o.a.crumbs.concat(o.a.me)}}},"0IYK":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return u}));var r=n("ERkP"),o=function(e){var t=e.router,n=e.global,o=e.initialNav,a=Object(r.useState)(o),i=a[0],s=a[1],c=Object(r.useState)(!1),u=c[0],l=c[1],d=Object(r.useState)(!0),f=d[0],p=d[1],b=Object(r.useState)(t.query),m=b[0],v=b[1],g=Object(r.useCallback)((function(){return v(t.query)}),[t]);Object(r.useEffect)((function(){return t.events.on("routeChangeComplete",g),function(){t.events.off("routeChangeComplete",g)}}),[t]);var h=Object(r.useCallback)((function(e){l(e),e&&f&&p(!1)}),[f]);return{actions:Object(r.useMemo)((function(){return{navTo:function(e){t.push(e)},replace:function(e){t.replace(e)},prefetch:function(e){t.prefetch(e)},back:function(){return t.back()},logEvent:function(e){n.ga&&n.ga("send",{hitType:"event",eventCategory:e.category,eventAction:e.action,eventLabel:e.label})},setNav:s,setFullscreenNav:h,reportError:function(e,t){console.log("ERROR",e,"LVL",t),alert(e.description||"Something went wrong! :/")}}}),[t,n]),state:Object(r.useMemo)((function(){return{nav:i,isFullscreenNav:u,neverFullscreenNav:f,sessionId:m.sid,battleMode:m.m}}),[i,u,f,m.sid,m.m])}},a=function(e){return e.split("/").slice(0,3).join("/")},i=function(e){return Object(r.useMemo)((function(){return{toHistory:function(){return e.push({pathname:a(e.pathname),query:{sid:e.query.sid,m:"history"}})},toGameLobby:function(){return e.push({pathname:a(e.pathname)})},toBattleLobby:function(){return e.push({pathname:a(e.pathname),query:{sid:e.query.sid,m:"battlelobby"}})},toBattleControls:function(){return e.push({pathname:a(e.pathname),query:{sid:e.query.sid,m:"playing"}})},toSession:function(t,n,r){return e[r?"replace":"push"]({pathname:a(e.pathname),query:{sid:t,m:n||"battlelobby"}})},toNewLocalBattle:function(t,n,r){return e.push({pathname:r?"/games/".concat(r,"/"):a(e.pathname),query:{sid:"new_".concat(t),m:n||"playing"}})}}}),[])},s=n("VmKQ"),c=n("TTWC"),u=function(e){var t=Object(c.b)(),n=i(t);return Object(r.useMemo)((function(){return{newLocalBattle:n.toNewLocalBattle,deleteSession:function(t,r){s.localSessionActions.deleteSession(t,e.gameId),r&&n.toGameLobby()},loadLocalSession:function(e){n.toSession(e)},forkBattleFrame:function(t,r){var o=s.localSessionActions.forkBattleFrame({battle:t,frame:r,api:e}).session;n.toSession(o.id)},importSession:function(t){var r=s.localSessionActions.importSession({seed:t,api:e}).session;n.toSession(r.id)}}}),[n,e])}},"20a2":function(e,t,n){e.exports=n("nOHt")},E01t:function(e,t){!function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var n=[],r=0;r<e.length;r+=3)for(var o=e[r]<<16|e[r+1]<<8|e[r+2],a=0;a<4;a++)8*r+6*a<=8*e.length?n.push(t.charAt(o>>>6*(3-a)&63)):n.push("=");return n.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],r=0,o=0;r<e.length;o=++r%4)0!=o&&n.push((t.indexOf(e.charAt(r-1))&Math.pow(2,-2*o+8)-1)<<2*o|t.indexOf(e.charAt(r))>>>6-2*o);return n}};e.exports=n}()},GB1H:function(e,t,n){"use strict";var r=n("gy4H"),o=n("Qetd");function a(e,t){return t.encode?t.strict?r(e):encodeURIComponent(e):e}function i(e){return Array.isArray(e)?e.sort():"object"===typeof e?i(Object.keys(e)).sort((function(e,t){return Number(e)-Number(t)})).map((function(t){return e[t]})):e}t.extract=function(e){return e.split("?")[1]||""},t.parse=function(e,t){var n=function(e){var t;switch(e.arrayFormat){case"index":return function(e,n,r){t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===r[e]&&(r[e]={}),r[e][t[1]]=n):r[e]=n};case"bracket":return function(e,n,r){t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==r[e]?r[e]=[].concat(r[e],n):r[e]=[n]:r[e]=n};default:return function(e,t,n){void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t=o({arrayFormat:"none"},t)),r=Object.create(null);return"string"!==typeof e?r:(e=e.trim().replace(/^(\?|#|&)/,""))?(e.split("&").forEach((function(e){var t=e.replace(/\+/g," ").split("="),o=t.shift(),a=t.length>0?t.join("="):void 0;a=void 0===a?null:decodeURIComponent(a),n(decodeURIComponent(o),a,r)})),Object.keys(r).sort().reduce((function(e,t){var n=r[t];return Boolean(n)&&"object"===typeof n&&!Array.isArray(n)?e[t]=i(n):e[t]=n,e}),Object.create(null))):r},t.stringify=function(e,t){var n=function(e){switch(e.arrayFormat){case"index":return function(t,n,r){return null===n?[a(t,e),"[",r,"]"].join(""):[a(t,e),"[",a(r,e),"]=",a(n,e)].join("")};case"bracket":return function(t,n){return null===n?a(t,e):[a(t,e),"[]=",a(n,e)].join("")};default:return function(t,n){return null===n?a(t,e):[a(t,e),"=",a(n,e)].join("")}}}(t=o({encode:!0,strict:!0,arrayFormat:"none"},t));return e?Object.keys(e).sort().map((function(r){var o=e[r];if(void 0===o)return"";if(null===o)return a(r,t);if(Array.isArray(o)){var i=[];return o.slice().forEach((function(e){void 0!==e&&i.push(n(r,e,i.length))})),i.join("&")}return a(r,t)+"="+a(o,t)})).filter((function(e){return e.length>0})).join("&"):""}},Kvs8:function(e,t){var n={utf8:{stringToBytes:function(e){return n.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(n.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}};e.exports=n},PDoO:function(e,t,n){"use strict";var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=l(n("ERkP")),i=l(n("h7kB")),s=l(n("GB1H")),c=l(n("bKUN")),u=l(n("Fuyq"));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var p=function(e){function t(){return d(this,t),f(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"render",value:function(){var e=this.props.protocol+"www.gravatar.com/avatar/",t=s.default.stringify({s:this.props.size,r:this.props.rating,d:this.props.default}),n=s.default.stringify({s:2*this.props.size,r:this.props.rating,d:this.props.default}),o=(""+this.props.email).trim().toLowerCase(),u=void 0;if(this.props.md5)u=this.props.md5;else{if("string"!==typeof this.props.email)return console.warn('Gravatar image can not be fetched. Either the "email" or "md5" prop must be specified.'),a.default.createElement("script",null);u=(0,i.default)(o,{encoding:"binary"})}var l=""+e+u+"?"+t,d=""+e+u+"?"+n,f=!0;"undefined"!==typeof window&&(f="srcset"in document.createElement("img"));var p="react-gravatar";this.props.className&&(p=p+" "+this.props.className);var b=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(this.props,[]);return delete b.md5,delete b.email,delete b.protocol,delete b.rating,delete b.size,delete b.style,delete b.className,delete b.default,!f&&(0,c.default)()?a.default.createElement("img",r({alt:"Gravatar for "+o,style:this.props.style,src:d,height:this.props.size,width:this.props.size},b,{className:p})):a.default.createElement("img",r({alt:"Gravatar for "+o,style:this.props.style,src:l,srcSet:d+" 2x",height:this.props.size,width:this.props.size},b,{className:p}))}}]),t}(a.default.Component);p.displayName="Gravatar",p.propTypes={email:u.default.string,md5:u.default.string,size:u.default.number,rating:u.default.string,default:u.default.string,className:u.default.string,protocol:u.default.string,style:u.default.object},p.defaultProps={size:50,rating:"g",default:"retro",protocol:"//"},e.exports=p},TTWC:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s}));var r=n("20a2"),o=n.n(r),a=n("ERkP"),i=Object(a.createContext)(o.a.router),s=function(){return Object(a.useContext)(i)}},bKUN:function(e,t){e.exports=function(){if("undefined"!==typeof window&&null!==window){if("(-webkit-min-device-pixel-ratio: 1.25), (min--moz-device-pixel-ratio: 1.25), (-o-min-device-pixel-ratio: 5/4), (min-resolution: 1.25dppx)",window.devicePixelRatio>1.25)return!0;if(window.matchMedia&&window.matchMedia("(-webkit-min-device-pixel-ratio: 1.25), (min--moz-device-pixel-ratio: 1.25), (-o-min-device-pixel-ratio: 5/4), (min-resolution: 1.25dppx)").matches)return!0}return!1}},gy4H:function(e,t,n){"use strict";e.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}},h7kB:function(e,t,n){!function(){var t=n("E01t"),r=n("Kvs8").utf8,o=n("oa2v"),a=n("Kvs8").bin,i=function(e,n){e.constructor==String?e=n&&"binary"===n.encoding?a.stringToBytes(e):r.stringToBytes(e):o(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var s=t.bytesToWords(e),c=8*e.length,u=1732584193,l=-271733879,d=-1732584194,f=271733878,p=0;p<s.length;p++)s[p]=16711935&(s[p]<<8|s[p]>>>24)|4278255360&(s[p]<<24|s[p]>>>8);s[c>>>5]|=128<<c%32,s[14+(c+64>>>9<<4)]=c;var b=i._ff,m=i._gg,v=i._hh,g=i._ii;for(p=0;p<s.length;p+=16){var h=u,y=l,O=d,j=f;u=b(u,l,d,f,s[p+0],7,-680876936),f=b(f,u,l,d,s[p+1],12,-389564586),d=b(d,f,u,l,s[p+2],17,606105819),l=b(l,d,f,u,s[p+3],22,-1044525330),u=b(u,l,d,f,s[p+4],7,-176418897),f=b(f,u,l,d,s[p+5],12,1200080426),d=b(d,f,u,l,s[p+6],17,-1473231341),l=b(l,d,f,u,s[p+7],22,-45705983),u=b(u,l,d,f,s[p+8],7,1770035416),f=b(f,u,l,d,s[p+9],12,-1958414417),d=b(d,f,u,l,s[p+10],17,-42063),l=b(l,d,f,u,s[p+11],22,-1990404162),u=b(u,l,d,f,s[p+12],7,1804603682),f=b(f,u,l,d,s[p+13],12,-40341101),d=b(d,f,u,l,s[p+14],17,-1502002290),u=m(u,l=b(l,d,f,u,s[p+15],22,1236535329),d,f,s[p+1],5,-165796510),f=m(f,u,l,d,s[p+6],9,-1069501632),d=m(d,f,u,l,s[p+11],14,643717713),l=m(l,d,f,u,s[p+0],20,-373897302),u=m(u,l,d,f,s[p+5],5,-701558691),f=m(f,u,l,d,s[p+10],9,38016083),d=m(d,f,u,l,s[p+15],14,-660478335),l=m(l,d,f,u,s[p+4],20,-405537848),u=m(u,l,d,f,s[p+9],5,568446438),f=m(f,u,l,d,s[p+14],9,-1019803690),d=m(d,f,u,l,s[p+3],14,-187363961),l=m(l,d,f,u,s[p+8],20,1163531501),u=m(u,l,d,f,s[p+13],5,-1444681467),f=m(f,u,l,d,s[p+2],9,-51403784),d=m(d,f,u,l,s[p+7],14,1735328473),u=v(u,l=m(l,d,f,u,s[p+12],20,-1926607734),d,f,s[p+5],4,-378558),f=v(f,u,l,d,s[p+8],11,-2022574463),d=v(d,f,u,l,s[p+11],16,1839030562),l=v(l,d,f,u,s[p+14],23,-35309556),u=v(u,l,d,f,s[p+1],4,-1530992060),f=v(f,u,l,d,s[p+4],11,1272893353),d=v(d,f,u,l,s[p+7],16,-155497632),l=v(l,d,f,u,s[p+10],23,-1094730640),u=v(u,l,d,f,s[p+13],4,681279174),f=v(f,u,l,d,s[p+0],11,-358537222),d=v(d,f,u,l,s[p+3],16,-722521979),l=v(l,d,f,u,s[p+6],23,76029189),u=v(u,l,d,f,s[p+9],4,-640364487),f=v(f,u,l,d,s[p+12],11,-421815835),d=v(d,f,u,l,s[p+15],16,530742520),u=g(u,l=v(l,d,f,u,s[p+2],23,-995338651),d,f,s[p+0],6,-198630844),f=g(f,u,l,d,s[p+7],10,1126891415),d=g(d,f,u,l,s[p+14],15,-1416354905),l=g(l,d,f,u,s[p+5],21,-57434055),u=g(u,l,d,f,s[p+12],6,1700485571),f=g(f,u,l,d,s[p+3],10,-1894986606),d=g(d,f,u,l,s[p+10],15,-1051523),l=g(l,d,f,u,s[p+1],21,-2054922799),u=g(u,l,d,f,s[p+8],6,1873313359),f=g(f,u,l,d,s[p+15],10,-30611744),d=g(d,f,u,l,s[p+6],15,-1560198380),l=g(l,d,f,u,s[p+13],21,1309151649),u=g(u,l,d,f,s[p+4],6,-145523070),f=g(f,u,l,d,s[p+11],10,-1120210379),d=g(d,f,u,l,s[p+2],15,718787259),l=g(l,d,f,u,s[p+9],21,-343485551),u=u+h>>>0,l=l+y>>>0,d=d+O>>>0,f=f+j>>>0}return t.endian([u,l,d,f])};i._ff=function(e,t,n,r,o,a,i){var s=e+(t&n|~t&r)+(o>>>0)+i;return(s<<a|s>>>32-a)+t},i._gg=function(e,t,n,r,o,a,i){var s=e+(t&r|n&~r)+(o>>>0)+i;return(s<<a|s>>>32-a)+t},i._hh=function(e,t,n,r,o,a,i){var s=e+(t^n^r)+(o>>>0)+i;return(s<<a|s>>>32-a)+t},i._ii=function(e,t,n,r,o,a,i){var s=e+(n^(t|~r))+(o>>>0)+i;return(s<<a|s>>>32-a)+t},i._blocksize=16,i._digestsize=16,e.exports=function(e,n){if(void 0===e||null===e)throw new Error("Illegal argument "+e);var r=t.wordsToBytes(i(e,n));return n&&n.asBytes?r:n&&n.asString?a.bytesToString(r):t.bytesToHex(r)}}()},iHP3:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("omng"),o=n("iPwq"),a={key:"gameindexnav",crumbs:[Object(r.a)()],me:Object(o.a)()}},krfZ:function(e,t,n){"use strict";n.d(t,"a",(function(){return dn}));var r=n("ODXe"),o=n("ERkP"),a=n.n(o),i=n("+lRJ"),s=n("rePB"),c=n("cDpP"),u=n("oHy9"),l=n("Xity"),d=n("Dba3"),f=n("9EWH"),p=["allqueenschess","amazons","ambivalente","aries","ataxx","atrium","bombardment","breakthrough","campaign","canthesardines","chameleon","coffee","connectfour","crossings","daggers","dao","descent","desdemona","duckpond","duplo","erdoslatino","euclid","gekitai","gogol","gowiththefloe","grensholm","hippolyta","hobbes","iago","jesonmor","jostle","kachitknight","kickrun","kingsvalley","krieg","madbishops","momentum","monkeyqueen","murusgallicus","neutreeko","neutron","orthokon","outwit","partisans","razzledazzle","sapos","scatter","serauqs","shoveoff","speedsoccolot","squava","stooges","support","threemusketeers","tobito","towers","towertwo","trafficlights","transet","tunneler","tyrannos","uglyduck","uisge","yonmoque","zonesh"],b=function(e){return Math.floor(Math.random()*Math.floor(e))},m={userId:"RANDY",userName:"Randy",password:"heydontbeme",gravatarHash:"0bb93d13ba17249145c60bdf0f509bc7"},v={userId:"thisisaveryrandomguid",userName:"Kurt",password:"kurt123"},g=function(e){return{challengeId:Math.random().toString().slice(2),gameId:e.gameId,issuer:{userId:e.user.userId,userName:e.user.userName,gravatarHash:e.user.gravatarHash},lookingFor:b(3),timestamp:Date.now()*Math.random()}};function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(s.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O=Object(d.a)(null),j=Object(d.a)([v,m]),w=Object(d.a)(null),I=function(e){for(var t={},n=0;n<1;n++){var r=g({user:v,gameId:e});t[r.challengeId]=r}for(var o=b(3)+1,a=0;a<o;a++){var i=g({user:m,gameId:e});t[i.challengeId]=i}return t},k=Object.fromEntries(p.map((function(e){return[e,I(e)]}))),S=Object(d.a)(k),E=Object(d.a)((function(e){var t=e(S),n=e(w);return n?t[n.gameId]:{}}),(function(e){var t=w.getValue(),n=t?t.gameId:"";if(!n)throw new Error("No current game registered!");S.update(y(y({},S.getValue()),{},Object(s.a)({},n,e)))})),P={acceptChallenge:function(e){return new Promise((function(t){var n=e.challengeId,r=e.as,o=e.gameId;S.update((function(e){return Object(f.a)(e,(function(e){e[o][n].accepting=!0}))})),setTimeout((function(){S.update((function(e){return Object(f.a)(e,(function(e){delete e[o][n]}))})),t(r)}),2e3)}))},createChallenge:function(e){return new Promise((function(t){var n=e.gameId,r=e.lookingFor,o=e.variantCode;setTimeout((function(){S.update((function(e){return Object(f.a)(e,(function(e){var a=O.getValue(),i={challengeId:Math.random().toString().slice(2),gameId:n,issuer:{userId:a.userId,userName:a.userName,gravatarHash:a.gravatarHash},lookingFor:r,variantCode:o,timestamp:Date.now()};e[n][i.challengeId]=i,t(i)}))}))}),2e3)}))},deleteChallenge:function(e){return new Promise((function(t){var n=e.challengeId,r=e.gameId;S.update((function(e){return Object(f.a)(e,(function(e){e[r][n].deleting=!0}))})),setTimeout((function(){S.update((function(e){return Object(f.a)(e,(function(e){delete e[r][n]}))})),t(!0)}),2e3)}))},subscribe:{forGame:function(e){var t=Object(d.b)(S,(function(t){return t.prop(e.gameId)}));return e.listener(t.getValue()),t.subscribe(e.listener)},forCurrentGame:function(e){return e.listener(E.getValue()),E.subscribe(e.listener)}}},C=function(e,t){for(var n=0,r=JSON.parse(JSON.stringify(t));n++<1e3;){var o=r.state.currentStepId,a=r.turn.steps[o],i=Object(c.N)(a),s=i[Math.floor(Math.random()*i.length)];if(Object(c.v)(s))r=e.performAction(r,"mark",s);else{if("endTurn"===s){r=e.performAction(r,"endTurn");break}r=e.performAction(r,"command",s)}}return r};function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){Object(s.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var T=function(e,t){return{id:e.userId,name:e.userName,type:t?"me":"remote"}},B=T(v,!0),A=T(m),L={},D=function(e){var t=w.getValue(),n=Math.random()<.5?1:2,r=function(e){for(var t=e.newBattle(),n=Math.floor(20*Math.random());!t.gameEndedBy&&n--;)t=C(e,t);return t}(t);return{battle:r,session:function(e){var t=e.battle,n=e.api,r=e.me,o=void 0===r?1:r,a=e.id,i=void 0===a?Object(c.A)(!0):a;return x(x({gameId:n.gameId,id:i,variantCode:t.variant.code,created:Date.now()-Math.floor(1e4*Math.random()),type:"remote",player:t.player,turn:t.turnNumber,path:t.path},t.gameEndedBy&&{endedBy:t.gameEndedBy}),{},{sprites:Object(c.c)({units:t.state.board.units,iconMap:n.iconMap,marks:t.gameEndedBy?t.state.board.marks:[]}),participants:{1:1===o?B:A,2:2===o?B:A}})}({api:t,battle:r,id:e,me:n})}},M=function(e,t){var n=w.getValue(),r=C(n,e);return{battle:r,session:Object(c.P)(r,t,n.iconMap)}},F={auth:{logout:function(){return O.update(null)},login:function(e){return new Promise((function(t,n){return setTimeout((function(){var r=j.getValue().find((function(t){return t.userName.toLowerCase()===e.userName.toLowerCase()&&t.password===e.password}));r?(O.update(r),t(r)):n(new Error("No user with that info found"))}),2e3)}))},subscribe:{user:function(e){return e.listener(O.getValue()),O.subscribe(e.listener)}}},challenge:P,battle:{subscribe:function(e){return L[e.sessionId]=e.listener,function(){delete L[e.sessionId]}},load:function(e){return new Promise((function(t){var n=D(e);setTimeout((function(){t(n),Object(c.w)(n.session)&&setTimeout((function(){var t;null===(t=L[e])||void 0===t||t.call(L,M(n.battle,n.session))}),2e3+5e3*Math.random())}),500+2e3*Math.random())}))},endTurn:function(e){return new Promise((function(t){var n=e.battle,r=e.session,o=w.getValue();setTimeout((function(){var a=o.performAction(n,"endTurn"),i=Object(c.P)(a,r,o.iconMap);t({battle:a,session:i}),setTimeout((function(){var t;null===(t=L[e.session.id])||void 0===t||t.call(L,M(a,i))}),2e3+5e3*Math.random())}),500+2e3*Math.random())}))}},game:{setGameAPI:function(e){w.update(e)},getGameAPI:function(){return w.getValue()}}},R=Object(o.createContext)(F),G=function(){return Object(o.useContext)(R)},K=function(){var e=Object(o.useState)(null),t=e[0],n=e[1],r=G();return Object(o.useEffect)((function(){return r.auth.subscribe.user({listener:n})})),t},U=function(){var e=Object(o.useState)({}),t=e[0],n=e[1],r=G();return Object(o.useEffect)((function(){return r.challenge.subscribe.forCurrentGame({listener:n})}),[]),t};function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){Object(s.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var V=n("o0o1"),z=n.n(V);function q(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(u){return void n(u)}s.done?t(c):Promise.resolve(c).then(r,o)}function Y(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){q(a,r,o,i,s,"next",e)}function s(e){q(a,r,o,i,s,"throw",e)}i(void 0)}))}}var W=n("VmKQ");function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){Object(s.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Q=n("+zLY"),Z=function(e,t){return{id:"game-".concat(e.gameId,"-session-").concat(e.sessionId,"-history"),title:"History",desc:"See previous moves in this session",onClick:e.battleNavActions.toHistory,links:t?[]:[$(e,!0)]}},$=function(e,t){return e.isNew?{id:"game-".concat(e.gameId,"-new"),title:"New battle",desc:"This battle just begun!",onClick:e.battleNavActions.toBattleControls,links:[]}:{id:"game-".concat(e.gameId,"-session-").concat(e.sessionId,"-play"),title:"Play",desc:"Make a move",onClick:e.battleNavActions.toBattleControls,links:t?[]:[Z(e,!0)]}},ee=function(e){var t=e.battleNavActions,n=e.session,r=e.meta,o=e.mode,a=e.isNew,i=Object(Q.a)(r);i.me.onClick=t.toGameLobby,delete i.me.url;var s=i.crumbs.concat(i.me),c=function(e){var t=e.battleNavActions,n=e.session,r=e.gameId,o="Overview and handling of this ".concat(n.endedBy?"finished":"ongoing"," session");return{id:"game-".concat(r,"-session-").concat(n.id,"-history"),title:"Session ".concat(n.id),shortTitle:"Manage",desc:o,onClick:t.toBattleLobby,links:[$({battleNavActions:t,gameId:r,sessionId:n.id}),Z({battleNavActions:t,gameId:r,sessionId:n.id})]}}({session:n,gameId:r.id,battleNavActions:t}),u=Z({gameId:r.id,battleNavActions:t,sessionId:n.id}),l=$({battleNavActions:t,isNew:a,gameId:r.id,sessionId:n.id});switch(o){case"battlelobby":return{key:"session-".concat(n.id,"-lobby"),crumbs:s,me:c};case"history":return{key:"session-".concat(n.id,"-history"),crumbs:s.concat(c),me:u};case"playing":return{key:a?"session-new":"session-".concat(n.id,"-playing"),crumbs:a?s:s.concat(c),me:l};case"gamelobby":return i;default:throw new Error('Cannot make session nav for unknown mode "'.concat(o,'"'))}};var te=n("X9hZ"),ne=n("PefU"),re={exportBattleInstruction:"exportBattleInstruction",exportBattleInputContainer:"exportBattleInputContainer"},oe=n("ARCc"),ae=n.n(oe),ie=n("EeF2"),se={input:"input"},ce=a.a.createElement,ue=function(e){var t=e.value,n=e.onChange,r=e.onValue,a=e.autoFocus,i=e.autoSelect,s=e.onEnter,c=e.onError,u=e.disabled,l=e.placeholder,d=e.controlId,f=e.password,p=Object(o.useRef)(null),b=Object(o.useRef)(!1);Object(o.useEffect)((function(){i&&p.current&&!b.current&&(p.current.select(),b.current=!0)}),[p.current,b.current,i]);var m=Object(o.useCallback)((function(e){if("Enter"===e.key&&s)if(c)try{s()}catch(e){var t=e;t.controlId=d,c(t)}else s()}),[s,c,d]),v=Object(o.useCallback)((function(e){n?n(e):r&&r(e.target.value)}),[n,r]);return ce("input",{placeholder:l,ref:p,disabled:u,onKeyDown:m,onChange:v,value:t,type:f?"password":"text",className:se.input,autoFocus:a})},le=a.a.createElement,de=function(){},fe=function(e){var t=e.meta,n=e.battle,r=e.session,o=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return ae.a[t]+Object(ie.b)(e,n)}({variantCode:n.variant.code,ended:Boolean(r.endedBy),player:r.player,turn:r.turn,path:n.path},t.id,0);return le("div",null,le("div",{className:re.exportBattleInstruction},"Save the string below somewhere, and then you can import in later in a different browser!"),le("div",{className:re.exportBattleInputContainer},le(ue,{value:o,onChange:de})))},pe=n("KQm4"),be=n("cg49"),me=n.n(be),ve={contentLine:"contentLine",contentPosition:"contentPosition",contentPlayer:"contentPlayer",contentPlayer0:"contentPlayer0",contentPlayer1:"contentPlayer1",contentPlayer2:"contentPlayer2",contentUnitType:"contentUnitType",contentSelectInstruction:"contentSelectInstruction"},ge=n("z7ul"),he=n("fqSr"),ye=Object(o.createContext)(null),Oe=a.a.createElement,je={endTurn:function(){},command:function(){}},we=function e(t){var n=t.content,a=t.actions,i=void 0===a?je:a,s=Object(o.useContext)(ye),c=Object(r.a)(s,1)[0].session;if(!n)return null;if(Object(ge.isAlgolContentLine)(n))return Oe("span",{className:ve.contentLine},n.line.map((function(t){return Oe(e,{key:Math.random(),content:t,actions:i})})));if(Object(ge.isAlgolContentText)(n))return Oe("span",null,n.text);if(Object(ge.isAlgolContentSelect)(n))return Oe("span",{className:ve.contentSelectInstruction},n.select);if(Object(ge.isAlgolContentCmnd)(n))return Oe(te.b,{onClick:function(){return i.command(n.command)},controlId:"content-command-".concat(n.command,"-button")},n.command);if(Object(ge.isAlgolContentEndTurn)(n))return Oe(te.b,{onClick:i.endTurn,controlId:"content-end-turn-button"},n.endTurn);if(Object(ge.isAlgolContentBold)(n))return Oe("strong",null,n.bold);if(Object(ge.isAlgolContentUnitType)(n)){var u=Object(r.a)(n.unittype,2),l=u[0],d=u[1];return Oe("span",{className:ve.contentUnitType},Oe(he.a,{owner:d,icon:l}))}if(Object(ge.isAlgolContentPos)(n)){var f=n.pos;return Oe("span",{className:ve.contentPosition},f)}if(Object(ge.isAlgolContentUnit)(n)){var p=Object(r.a)(n.unit,3),b=p[0],m=p[1],v=p[2];return Oe("span",{className:ve.contentPosition},v," ",Oe(e,{actions:i,content:{unittype:[b,m]}}))}if(Object(ge.isAlgolContentPlayer)(n)){var g,h,y=n.player;return 1===y?Oe("span",{className:me()(ve.contentPlayer,ve.contentPlayer1)},null!==(h=null===c||void 0===c?void 0:c.participants[1].name)&&void 0!==h?h:"Player 1"):0===y?Oe("span",{className:me()(ve.contentPlayer,ve.contentPlayer0)},"Player 0"):Oe("span",{className:me()(ve.contentPlayer,ve.contentPlayer2)},null!==(g=null===c||void 0===c?void 0:c.participants[2].name)&&void 0!==g?g:"Player 2")}return null},Ie=a.a.createElement,ke=function(e){var t=e.session,n=t.endedBy?{line:[{text:"Ended in turn ".concat(t.turn," by ")},{bold:t.endedBy}].concat(Object(pe.a)(t.player?[{text:", "},{player:t.player},{text:" wins!"}]:[{text:" in a draw!"}]))}:{line:[{text:"Turn ".concat(t.turn,", ")},{player:t.player},{text:" to play"}]};return Ie(we,{content:n})},Se=a.a.createElement,Ee=function(e){var t=e.session,n=e.variant,r=e.manyVariants,a=e.gameName;return Se(o.Fragment,null,Se("p",null,"This ",r?n.desc+" variant":""," ",a," battle with id ",Se("code",null,t.id)," was"," ","normal"===t.type?"created":"fork"===t.type?"forked":"imported"," ",Pe(t.created),t.updated&&Pe(t.updated)!==Pe(t.created)&&Se(o.Fragment,null," and updated ",Pe(t.updated)),". ",Se(ke,{session:t}),"."))},Pe=function(e){return new Date(e).toString().slice(0,10)},Ce={boardPageHeadline:"boardPageHeadline",boardPageCopy:"boardPageCopy"},Ne=a.a.createElement,xe=function(e){var t=e.title,n=e.children;return Ne("div",null,Ne("div",{className:Ce.boardPageHeadline},t),Ne("div",{className:Ce.boardPageCopy},n))},Te=a.a.createElement,Be=function(e){var t=e.session,n=e.meta,r=e.battle,a=e.manyVariants,i=Object(l.f)(),s=Object(l.k)(),c=Object(o.useState)(!1),u=c[0],d=c[1],f=Object(o.useMemo)((function(){return{closeModal:function(){return d(!1)},openModal:function(){return d(!0)}}}),[d]),p=f.closeModal,b=f.openModal,m=1===r.turnNumber&&1===r.player,v="".concat(r.gameEndedBy?"Finished":"Ongoing"," ").concat("remote"===t.type?"remote":"local"," session");return Te(o.Fragment,null,Te(xe,{title:v},Te(Ee,{session:t,variant:r.variant,manyVariants:a,gameName:n.name}),Te("p",null,"You can"," ",Te(te.b,{disabled:m&&"You can export the session after the first turn is finished!",onClick:b},"export")," ","the session to continue it elsewhere, or"," ",Te(te.b,{onError:i.reportError,intent:"danger",controlId:"delete-session-button",onClick:function(){confirm("Are you sure you want to delete this session? It will be forever lost!")&&s.deleteSession(t.id,!0)}},"delete")," ","it if you don't want it around.")),Te(ne.a,{isOpen:u,onClose:p,title:"Export session"},Te(fe,{battle:r,meta:n,session:t})))},Ae={newLocalSession:"newLocalSession",newLocalSessionDivider:"newLocalSessionDivider",newLocalSessionHeader:"newLocalSessionHeader",newLocalSessionTopInstruction:"newLocalSessionTopInstruction"},Le={sessionListInstruction:"sessionListInstruction",sessionListFullError:"sessionListFullError",sessionListItemErrorInfo:"sessionListItemErrorInfo",sessionListEmpty:"sessionListEmpty",sessionListInfo:"sessionListInfo"},De=n("zqG+"),Me=a.a.createElement,Fe=function(e){var t=e.error,n=e.meta,r=e.wipe,a=Object(l.f)();return Me(o.Fragment,null,Me("div",{className:Le.sessionListFullError},"The save data for this game is corrupt! :/"),Me(De.a,null,Me(te.b,{onClick:function(){return a.reportError(Object(ge.decorateError)({err:t,description:"Something went wrong when trying to retrieve the stored sessions for ".concat(n.name,"."),errorId:"local-session-full-error",meta:{gameId:n.id}}),"severe")},controlId:"local-session-full-error-btn"},"Report error"),Me(te.b,{onClick:r,controlId:"local-session-full-error-purge"},"Remove corrupted save data")))},Re=n("si9A"),Ge=n("uTtv"),Ke=a.a.createElement,Ue=[],He={},_e=function(e){var t=e.fail,n=e.graphics,r=e.meta,o=Object(l.f)(),a=Ke(Re.a,{graphics:n,potentialMarks:Ue,marks:Ue,units:He}),i=Ke("div",{className:Le.sessionListItemErrorInfo},"The save data for this session is corrupt :/");return Ke(Ge.a,{pic:a,content:i,onClick:function(){return o.reportError(Object(ge.decorateError)({err:t.error,description:"Something has happened to this ".concat(r.name," save file, and it couldn't be correctly read."),errorId:"local-save-parse-error",meta:{gameId:r.id,saveStr:t.error.message,saveId:t.id}}),"severe")}})},Ve=n("Pl1n"),ze=a.a.createElement,qe=function(e){var t=e.session,n=e.variant,r=e.corrupt;return ze("div",{className:Le.sessionListInfo},n.desc[0].toUpperCase(),n.desc.slice(1)," battle ID ",t.id,ze("br",null),"fork"===t.type?"Forked":"imported"===t.type?"Imported":"Created",": ",new Date(t.created).toString().slice(0,10),ze("br",null),t.updated&&ze(o.Fragment,null,"Updated: ",new Date(t.updated).toString().slice(0,10),ze("br",null)),r?ze("div",{className:Le.sessionListItemErrorInfo},r):ze(ke,{session:t}))},Ye=a.a.createElement,We=[],Je=function(e){var t=e.session,n=e.graphics,r=e.variant,o=e.error,a=Object(l.k)(),i=Object(Ve.a)(t.sprites),s=Ye(Re.a,{graphics:n,potentialMarks:We,marks:i.marks,units:i.units,name:r.board}),c=Ye(qe,{session:t,variant:r,corrupt:null===o||void 0===o?void 0:o.message});return Ye(Ge.a,{pic:s,content:c,onClick:function(){a.loadLocalSession(t.id)}})},Xe=a.a.createElement,Qe=function(e){var t=Object(l.j)(),n=t.api,r=t.meta,a=t.graphics,i=e.sessionInfo,s=Object(o.useCallback)((function(){return W.localSessionActions.deleteGameSessions(n.gameId)}),[n]);if(!i||!1===i.retrieved)return null;if(i.retrieved instanceof Error)return Xe(Fe,{meta:r,wipe:s,error:i.retrieved});var c=!1,u=Object.values(i.containers);return Xe("div",null,0===u.length?Xe("div",{className:Le.sessionListEmpty},"No saved sessions found"):u.map((function(e){var t=n.variants.find((function(t){return t.code===e.session.variantCode}));return e.session&&t?(e.error&&(c=!0),Xe(Je,{key:e.id,session:e.session,graphics:a,variant:n.variants.find((function(t){return t.code===e.session.variantCode})),error:e.error})):(c=!0,Xe(_e,{key:e.id,graphics:a,fail:e,meta:r}))})),c&&Xe(De.a,null,Xe(te.b,{onClick:s,controlId:"session-list-remove-error-lines-btn"},"Remove corruped session saves")))},Ze={inputButton:"inputButton"},$e=a.a.createElement,et=function(e){var t=e.value,n=e.onChange,r=e.onValue,o=e.onEnter,a=e.onClick,i=e.onError,s=e.inputDisabled,c=e.buttonDisabled,u=e.children,l=e.autoFocus,d=e.autoSelect,f=e.placeholder,p=e.controlId;return $e("div",{className:Ze.inputButton},$e(ue,{value:t,onChange:n,onValue:r,onEnter:o,onError:i,controlId:p,disabled:s,autoFocus:l,autoSelect:d,placeholder:f}),$e(te.b,{onClick:a,disabled:c,controlId:p,onError:i},u))},tt=a.a.createElement,nt=function(){var e=Object(o.useState)(""),t=e[0],n=e[1],r=Object(l.k)(),a=Object(l.f)();return tt(et,{onClick:function(){return r.importSession(t)},onEnter:function(){return r.importSession(t)},onError:a.reportError,value:t,onValue:n,buttonDisabled:!t&&"Enter a savestring!",placeholder:"Enter savestring",controlId:"import-seed-input-button"},"Import")},rt={boxContainer:"boxContainer"},ot=a.a.createElement,at=function(e){var t=e.title,n=e.children;return ot("fieldset",{className:rt.boxContainer},ot("legend",null,t),n)},it={radioSelectorLabel:"radioSelectorLabel",radioSelectorInnerDiv:"radioSelectorInnerDiv",radioSelectorTitle:"radioSelectorTitle"},st=a.a.createElement,ct=function(e){var t=e.value,n=e.options,r=e.group,a=e.onSelect,i=e.title,s=Object(o.useMemo)((function(){return n.map((function(e){return st("label",{key:e.value,className:it.radioSelectorLabel},st("input",{type:"radio",id:String(e.value),name:r,value:e.value,checked:e.value===t,onChange:function(){return a(e.value)}}),e.desc)}))}),[t,n,r,a]);return st("div",null,i&&st("div",{className:it.radioSelectorTitle},i),st("div",{className:it.radioSelectorInnerDiv},s))},ut=a.a.createElement,lt=function(e){var t=e.onSelect,n=e.variants,r=e.current,a=Object(o.useMemo)((function(){return n.map((function(e){return{value:e.code,desc:e.desc}}))}),[n]);return ut(ct,{title:"Variant",options:a,onSelect:t,value:r,group:"variant"})},dt=a.a.createElement,ft=function(e){var t=e.variants,n=Object(l.h)(),a=t.filter((function(e){return!e.hidden})),i=Object(o.useState)(a[0].code),s=i[0],c=i[1],u=Object(l.j)().api,f=Object(d.c)(W.localSessionActions.getGameSessionsAtom(u)),p=Object(r.a)(f,1)[0];return dt("div",{className:Ae.newLocalSession},dt("div",{className:Ae.newLocalSessionTopInstruction},"Games are saved at turn end to the browser storage."),dt(at,{title:"New local session"},dt(o.Fragment,null,a.length>1&&dt(o.Fragment,null,dt(lt,{variants:a,current:s,onSelect:c}),dt("br",null)),dt(te.b,{big:!0,onClick:function(){return n.toNewLocalBattle(s)},text:"Create"}))),dt(at,{title:"Load previous session"},dt(Qe,{sessionInfo:p})),dt(at,{title:"Import session"},dt(nt,null)))},pt={AuthGuardForm:"AuthGuardForm"},bt=a.a.createElement,mt=function(e){var t=e.Content,n=e.noHeader,r=e.bypass,a=e.children,i=Object(o.useState)(""),s=i[0],c=i[1],u=Object(o.useState)(""),l=u[0],d=u[1],f=Object(o.useState)(!1),p=f[0],b=f[1],m=K(),v=G(),g=function(e){e.preventDefault(),b(!0),v.auth.login({userName:s,password:l}).then((function(){c(""),d("")})).catch((function(e){return alert(e.message)})).finally((function(){return b(!1)}))},h=t?bt(t,null):null!==a&&void 0!==a?a:null;return m||r?n||r?h:bt("div",null,bt("p",null,"Logged in as ",null===m||void 0===m?void 0:m.userName,"!"," ",bt(te.b,{onClick:v.auth.logout},"Sign out")),bt("hr",null),h):bt("form",{className:pt.AuthGuardForm,onSubmit:g},bt("p",null,"Must log in!"),bt(ue,{value:s,onValue:c,disabled:p,placeholder:"username (kurt)",autoSelect:!0}),bt("br",null),bt("br",null),bt(ue,{value:l,onValue:d,disabled:p,placeholder:"password (kurt123)",password:!0}),bt("br",null),bt("br",null),bt(De.a,null,bt(te.b,{text:"Log in",disabled:p,onClick:g})))},vt={challengeListContainer:"challengeListContainer"},gt=n("PDoO"),ht=n.n(gt),yt=n("OoBi"),Ot=a.a.createElement,jt=function(e){var t=e.challenge,n=e.as,r=t.accepting,o=t.deleting,a=G(),i=0===t.lookingFor||t.lookingFor===n,s=r||o;return Ot(te.a,{onClick:function(){return a.challenge.acceptChallenge({challengeId:t.challengeId,gameId:t.gameId,as:n})},disabled:!i||s},Ot("span",{className:yt.a[1===n?"md-plr-1":"md-plr-2"]},"Plr",n))},wt=a.a.createElement,It=function(e){var t=e.challenge,n=G(),r=t.challengeId,o=t.gameId,a=t.accepting,i=t.deleting,s=a||i;return wt(te.a,{text:"X",onClick:function(){return n.challenge.deleteChallenge({challengeId:r,gameId:o})},disabled:s})},kt=a.a.createElement,St=function(e){var t=e.challenge,n=K(),r=t.issuer,a=kt(ht.a,{size:80,md5:r.gravatarHash||r.userId}),i=r.userName,s=kt("div",null,"wants to play!"),c=(null===n||void 0===n?void 0:n.userId)===r.userId?kt(It,{challenge:t}):kt(o.Fragment,null,kt("div",null,kt("small",null,"Accept as")),2!==t.lookingFor&&kt(jt,{challenge:t,as:1}),1!==t.lookingFor&&kt(jt,{challenge:t,as:2}));return kt(Ge.a,{pic:a,title:i,content:s,actions:c})},Et=a.a.createElement,Pt=function(e){var t=e.challenges;return Et("div",{className:vt.challengeListContainer},t.filter((function(e){return!e.deleting})).map((function(e){return Et(St,{challenge:e,key:e.challengeId})})))},Ct={newRemoteSessionContainer:"newRemoteSessionContainer",newRemoteSessionTopInstruction:"newRemoteSessionTopInstruction",newRemoteSessionForm:"newRemoteSessionForm"},Nt=a.a.createElement,xt=[{value:1,desc:"plr1"},{value:2,desc:"plr2"},{value:0,desc:"any"}],Tt=function(){var e=Object(l.i)(),t=e.variants.filter((function(e){return!e.hidden})),n=Object(o.useState)(t[0].code),r=n[0],a=n[1],i=Object(o.useState)(0),s=i[0],c=i[1],u=G();return Nt("div",{className:Ct.newRemoteSessionForm},Nt(lt,{variants:t,current:r,onSelect:a}),Nt(ct,{onSelect:c,value:s,options:xt,group:"opp",title:"Opponent is"}),Nt("div",null,Nt(te.a,{onClick:function(){return u.challenge.createChallenge({lookingFor:s,gameId:e.gameId,variantCode:r})},text:"Create"})))},Bt=a.a.createElement,At=function(){return Bt(mt,{Content:Lt})},Lt=function(){var e=function(){var e=K(),t=U();return Object(o.useMemo)((function(){return Object.values(t).filter((function(t){return t.issuer.userId===(null===e||void 0===e?void 0:e.userId)}))}),[t,e])}(),t=function(){var e=K(),t=U();return Object(o.useMemo)((function(){return Object.values(t).filter((function(t){return t.issuer.userId!==(null===e||void 0===e?void 0:e.userId)}))}),[t,e])}();return Bt(o.Fragment,null,Bt("div",{className:Ct.newRemoteSessionTopInstruction},"Online play not yet fully implemented!"),Bt(at,{title:"My challenges"},Bt(Tt,null),Bt(Pt,{challenges:e})),Bt(at,{title:"Challenges by others"},Bt(Pt,{challenges:t})))},Dt=a.a.createElement,Mt=function(e){var t=e.meta,n=e.graphics,a=e.previousSessionId,i=e.variants,s=Object(u.d)(),d=Object(r.a)(s,3),f=d[0],p=d[1],b=d[2],m=Object(u.d)(),v=Object(r.a)(m,3),g=v[0],h=v[1],y=v[2],O=Object(l.g)(),j=O.battleMode,w=O.sessionId;return Object(o.useEffect)((function(){b()}),[j,w]),Dt(o.Fragment,null,Dt(xe,{title:t.name},Dt("p",null,Object(c.G)(t.tagline,"!")," A game"," ",t.author?"by ".concat(t.author):"of unknown origin","."," ","GENESIS"===t.added?"Included in Chessicals since the beginning.":"Added to Chessicals "+t.added+" by "+(t.addedBy||"David Waller")+"."),Dt("p",null,"Play ",Dt(te.b,{onClick:p},"local")," or"," ",Dt(te.b,{onClick:h},"online"),"!")),Dt(ne.a,{isOpen:g,onClose:y,title:"Online play (WIP)"},Dt(At,null)),Dt(ne.a,{isOpen:f,onClose:b,title:"Local pass-and-play"},Dt(ft,{meta:t,graphics:n,previousSessionId:a,variants:i})))},Ft={stepperRange:"stepperRange"},Rt=n("t7Ad"),Gt=a.a.createElement,Kt=function(e){var t=e.onChange,n=e.max,r=e.current;return Gt(Rt.a,{leftDisabled:0===r,onLeft:function(){return t(r-1)},rightDisabled:r===n,onRight:function(){return t(r+1)}},Gt("input",{className:Ft.stepperRange,type:"range",min:0,max:n,step:1,value:r,onChange:function(e){return t(+e.target.value)}}))},Ut={battleHistoryContainer:"battleHistoryContainer"},Ht=a.a.createElement,_t=function(e){var t=e.content,n=e.frame,r=e.toFrame,o=e.battle,a=o.history.length-1,i=o.history[n],s=Object(l.k)().forkBattleFrame,c=Object(l.f)().reportError;return 0===a?Ht("div",{className:Ut.battleHistoryContainer},"After the first turn you will be able to replay the battle history here!"):Ht(xe,{title:"Session history"},Ht("div",{className:Ut.battleHistoryContainer},Ht(Kt,{max:a,current:n,onChange:r}),Ht(we,{content:t}),Ht("p",null,"You can"," ",Ht(te.b,{onClick:function(){confirm("Do you create a copy of this session from this point in the history, and switch to the new session?")&&s(o,n)},onError:c,controlId:"fork-history-frame-button",disabled:o.gameEndedBy&&n===a?"Cannot fork a finished battle!":(0===n||1===i.turn&&1===i.player)&&"Cannot fork the beginning of a battle"},"fork")," ","a new session from this point.")))},Vt={battleHelpContentContainer:"battleHelpContentContainer"},zt=a.a.createElement,qt=function(e){var t=e.actions,n=e.instruction;return zt(a.a.Fragment,null,zt("div",{className:Vt.battleHelpContentContainer},zt(we,{content:n,actions:t})))},Yt={battleControlsContent:"battleControlsContent"},Wt=a.a.createElement,Jt=function(e){var t=e.ui,n=e.actions,a=void 0!==t.winner&&"Battle is over!";return Wt(o.Fragment,null,Wt(De.a,null,Object.entries(t.commands).map((function(e){var t=Object(r.a)(e,2),o=t[0],i=t[1];return Wt(te.b,{disabled:a||!i.available&&"You cannot ".concat(o," right now"),onClick:function(){return n.command(o)},key:o},o)})),Wt(te.b,{big:!0,disabled:a||!t.endTurn&&"You haven't made a complete turn yet",onClick:n.endTurn},"End turn")),void 0!==t.winner&&Wt("div",{className:Yt.battleControlsContent},Wt(we,{content:t.instruction})))},Xt={switchContainer:"switchContainer",switchIndicator:"switchIndicator"},Qt=a.a.createElement,Zt=function(){},$t=function(e){var t=e.flipped,n=e.onFlip,r=e.text;return Qt("label",{className:Xt.switchContainer,onClick:n},Qt("input",{type:"checkbox",checked:t,onChange:Zt}),Qt("span",{className:Xt.switchIndicator}),r)},en=n("ZxJq"),tn=n("9Mtu"),nn=a.a.createElement,rn=function(e){var t=e.ui,n=e.rules,i=e.actions,s=Object(o.useState)(!0),c=s[0],l=s[1],d=Object(u.d)(),f=Object(r.a)(d,3),p=f[0],b=f[1],m=f[2];return nn(a.a.Fragment,null,nn(tn.a,null,nn(a.a.Fragment,null,nn(De.a,null,nn(we,{content:{line:[{text:"turn ".concat(t.turnNumber,", ")},{player:t.player}]}}),nn(te.b,{disabled:void 0!==t.winner?"Battle is over":!t.undo&&"No command to undo",onClick:i.undoBattleCommand},"Undo"),nn(te.b,null,nn($t,{text:"Text",flipped:c,onFlip:function(){return l(!c)}}))," ",nn(te.b,{onClick:b},"Peek rules")),c?nn(qt,{actions:i,instruction:t.instruction}):nn(Jt,{actions:i,ui:t}))),nn(ne.a,{isOpen:p,onClose:m,title:"How to play",subtitle:"updated ".concat(n.updated)},nn(en.a,{html:n.html})))},on={centerBox:"centerBox"},an=a.a.createElement,sn=function(e){var t=e.mode,n=e.ui,r=e.battleActions,o=e.gamePayload,a=e.battleState,i=a.frame,s=a.battle,u=a.session,l=o.api,d=o.graphics,f=o.meta,p=o.rules,b=Object(W.getLatestSessionIdForGame)(l.gameId);if("session"===a.loading)return an("div",{className:on.centerBox},"...loading...");if("endTurn"===a.loading)return an("div",{className:on.centerBox},"...submitting...");if("history"===t)return an(_t,{content:n.instruction,frame:Math.max(0,i),toFrame:r.toFrame,battle:s});if("battlelobby"===t)return an(Be,{battle:s,session:u,meta:f,manyVariants:l.variants.length>1});if("playing"===t){if(Object(c.w)(u)&&void 0===n.winner){var m={line:[{text:"...waiting for "},{player:u.player},{text:" to make a move..."}]};return an("div",{className:on.centerBox},an(we,{content:m}))}return an(rn,{actions:r,ui:n,rules:p})}return an(Mt,{meta:f,graphics:d,previousSessionId:b,variants:l.variants})},cn=a.a.createElement,un=function(e){var t=e.ui,n=e.mode,r=e.graphics,o=e.mark,a=e.battleState,i=null!==a&&void 0!==a?a:{},s=i.battle,u=i.session,l="playing"===n&&!s.gameEndedBy&&!Object(c.w)(u);return cn(Re.a,{callback:o,graphics:r,units:t.board.units,marks:t.board.marks,potentialMarks:t.board.potentialMarks,anim:t.board.anim,active:l,name:"gamelobby"!==n?s.variant.board:"basic"})},ln=a.a.createElement,dn=function(){var e=Object(l.j)(),t=e.api,n=e.graphics,a=e.meta,s=e.demo,d=Object(l.g)(),f=d.battleMode,p=void 0===f?"gamelobby":f,b=d.sessionId,m=function(e){var t=G(),n=Object(u.c)(),r=Object(l.g)().sessionId,a=Object(o.useState)({frame:-1}),i=a[0],s=a[1];return[i,Object(o.useMemo)((function(){return{wipe:function(){s({frame:-1})},toFrame:function(e){return s((function(t){return X(X({},t),{},{frame:e})}))},subscriptionUpdate:function(e,t){s({battle:t,session:e,frame:t.history.length-1,loading:null})},newLocalSession:function(t){var n=W.localSessionActions.newSession({api:e,code:t}),r=n.battle,o=n.session;s({battle:r,frame:0,session:o})},loadSession:function(){var r=Y(z.a.mark((function r(o){var a,i,u,l,d,f,p,b;return z.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("remote"!==Object(c.K)(o)){r.next=10;break}return s({frame:-1,loading:"session"}),r.next=4,t.battle.load(o);case 4:a=r.sent,i=a.battle,u=a.session,n()&&s({frame:i.history.length-1,session:u,battle:i}),r.next=14;break;case 10:l=W.localSessionActions.loadSession({sessionId:o,api:e}),d=l.session,f=l.battle,(p=l.error)&&(alert(p),s({frame:-1})),b=f?f.history.length-1:-1,s({battle:f,session:d,frame:b});case 14:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),endTurn:function(){var o=Y(z.a.mark((function o(){var a,i,u,l,d;return z.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if("remote"!==Object(c.K)(r)){o.next=17;break}return s((function(e){return a=e.session,i=e.battle,X(X({},e),{},{loading:"endTurn"})})),o.prev=2,o.next=5,t.battle.endTurn({session:a,battle:i});case 5:u=o.sent,l=u.session,d=u.battle,n()&&s({session:l,battle:d,frame:d.history.length-1,loading:null}),o.next=15;break;case 11:o.prev=11,o.t0=o.catch(2),alert(o.t0),s((function(e){return X(X({},e),{},{loading:null})}));case 15:o.next=18;break;case 17:s((function(t){var n=e.performAction(t.battle,"endTurn"),r=W.localSessionActions.updateSessionFromBattle({battle:n,session:t.session,api:e});return{frame:n.history.length-1,battle:n,session:r}}));case 18:case"end":return o.stop()}}),o,null,[[2,11]])})));return function(){return o.apply(this,arguments)}}(),mark:function(t){s((function(n){return X(X({},n),{},{battle:e.performAction(n.battle,"mark",t)})}))},command:function(t){s((function(n){return X(X({},n),{},{battle:e.performAction(n.battle,"command",t)})}))},undoBattleCommand:function(){s((function(t){return X(X({},t),{},{battle:e.performAction(t.battle,"undo")})}))}}}),[e,r])]}(t),v=Object(r.a)(m,2),g=v[0],h=v[1],y=g.battle?p:"gamelobby",O=function(e){var t=e.demo,n=e.mode,r=e.api,a=e.state,i=Object(l.g)().sessionId,s=K(),d=a.frame,f=a.loading,p=a.battle,b=a.session,m="gamelobby"===n||"session"===f||!s&&"remote"===Object(c.K)(i),v=Object(u.b)({demo:t,playing:m,restart:!0,gameId:r.gameId}),g=v.frame,h=v.hydrDemo,y=Object(o.useRef)(0);return Object(o.useMemo)((function(){if(m)return h?Object(c.m)(h,g):c.p;if(!p)return c.p;var e=r.getBattleUI(p);if("playing"===n)return Object(c.w)(b)?_(_({},e),{},{board:_(_({},e.board),{},{potentialMarks:[]})}):e;if("battlelobby"===n)return _(_({},e),{},{board:_(_({},e.board),{},{potentialMarks:[],marks:p.gameEndedBy?e.board.marks:[]})});if("history"===n){var t=_(_({},e),{},{turnNumber:p.history[d].turn,player:p.history[d].player,board:p.history[d].board,instruction:p.history[d].description});return y.current!==d&&(y.current!==d-1&&(t.board=_(_({},t.board),{},{anim:c.o})),y.current=d),t}throw new Error('Unknown UI request! Mode: "'.concat(n,'", has battle: "').concat(Boolean(p),'"'))}),[p,h,g,d,n])}({api:t,state:g,demo:s,mode:p});return function(e){var t=e.api,n=e.sessionId,r=e.state,a=e.actions,i=e.mode,s=e.meta,d=(e.ui,Object(l.h)()),f=Object(l.f)(),p=Object(o.useRef)(!1),b=K(),m=Object(u.c)(),v=G();Object(o.useEffect)((function(){return v.game.setGameAPI(t),function(){return v.game.setGameAPI(null)}}),[t]);var g=Object(o.useRef)();Object(o.useEffect)((function(){var e;null===(e=g.current)||void 0===e||e.call(g),n&&"remote"===Object(c.K)(n)&&(g.current=v.battle.subscribe({sessionId:n,listener:function(e){var t=e.battle,n=e.session;m()&&a.subscriptionUpdate(n,t)}}))}),[n]),Object(o.useEffect)((function(){f.setNav("gamelobby"===i||"remote"===Object(c.K)(n)&&!b?Object(Q.a)(s):ee({mode:i,session:r.session,battleNavActions:d,meta:s,isNew:Boolean(n&&n.match(/new/))}))}),[i,n,f,d,b]),Object(o.useEffect)((function(){return Object(W.setLatestVisitedGameId)(t.gameId)}),[t.gameId]),Object(o.useEffect)((function(){if(n)if(n.match(/^new_/)){var e=n.slice(4);p.current=!0,a.newLocalSession(e)}else a.loadSession(n);else a.wipe()}),[n,t]);var h=r.session&&r.session.id,y=(r.battle&&r.battle.history.length||0)>=2;Object(o.useEffect)((function(){!p.current&&n&&n.match(/^new_/)&&h&&y&&(Object(W.setLatestSessionInfo)(t.gameId,h),d.toSession(h,"playing",!0))}),[n,h,y]),p.current=!1}({api:t,actions:h,state:g,meta:a,mode:y,sessionId:b,ui:O}),ln(i.a,{title:a.name,top:ln(ye.Provider,{value:[g,h]},ln(un,{ui:O,mode:y,graphics:n,battleState:g,mark:h.mark})),body:ln(ye.Provider,{value:[g,h]},ln(mt,{bypass:"remote"!==Object(c.K)(b),noHeader:!0},ln(sn,{ui:O,mode:y,battleActions:h,battleState:g,gamePayload:e})))})}},"nIA/":function(e,t,n){"use strict";n.d(t,"a",(function(){return U}));var r=n("rePB"),o=n("cDpP");function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s=[],c={};function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e){var t=e.turn.steps[e.state.currentStepId],n={win:e.player,lose:1===e.player?2:1,draw:0}[t.LINKS.endGame],r={marks:t.LINKS.endMarks||[],units:t.UNITDATA,anim:o.o,potentialMarks:[]},a={line:[{text:"Ended by "},{bold:t.LINKS.endedBy}].concat(n?[{text:", "},{player:n},{text:" wins!"}]:[{text:" in a draw!"}])};return l(l({},e),{},{gameEndedBy:t.LINKS.endedBy,winner:n,history:e.history.concat(e.state.entries).concat({path:e.path,turn:t.TURN,player:0,board:r,description:a}),state:l(l({},e.state),{},{undo:null,board:r})})}var f=function(e){for(var t=[],n="root",r=e.state.currentStepId.split("-").slice(1).concat("endTurn"),a=function(){var a=r.shift(),i=Object(o.N)(e.turn.steps[n]),s=i.findIndex((function(e){return e===a}));if(-1===s)throw console.log(n,a,i),new Error("Failed to find action index while building turnpath");i.length>1&&t.push(s),n=n+"-"+a};r.length;)a();return t};function p(e){var t=e.LINKS;t.starvation?(t.endGame=t.starvation.endGame,t.endedBy=t.starvation.endedBy,t.endMarks=t.starvation.endMarks||Object.keys(e.UNITLAYERS.myunits||{})):(t.endGame="win",t.endedBy="starvation",t.endMarks=Object.keys(e.UNITLAYERS.myunits||{}))}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t){var n=m(m({},t),{},{path:t.path.concat(f(t))}),r=n.turn.steps[n.state.currentStepId];if(r.LINKS.endGame)return d(n);var a=function(e,t,n){var r=t.steps[n];if(t.nextTurns[n])return N(e,t.nextTurns[n]);var o=e.action[r.LINKS.endTurn](r);return N(e,x(o))}(e,n.turn,n.state.currentStepId);return a.canEnd?{variant:n.variant,path:n.path,turnNumber:a.steps.root.TURN,player:1===n.player?2:1,turn:a,history:n.history.concat(n.state.entries),state:{currentStepId:"root",entries:[],markStamps:{},undo:null,board:{marks:[],units:a.steps.root.UNITDATA,anim:a.steps.root.anim||o.o,potentialMarks:Object.keys(a.steps.root.LINKS.marks)}}}:(p(r),d(n))}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j(e,t){var n=t.state.currentStepId,r=t.turn.steps[n];if("root"===n){var o="startTurn_".concat(t.variant.ruleset,"_").concat(t.player);if(!e.instruction[o])throw new Error("Couldnt find function ".concat(o));return e.instruction[o](r)}if(t.gameEndedBy)return 0===t.winner?{line:[{text:"Game ended in a draw through "},{bold:t.gameEndedBy},{text:"!"}]}:{line:[{player:t.winner},{text:" won through "},{bold:t.gameEndedBy},{text:"!"}]};var a=n.split("-"),i=a.slice(-1).pop(),s=a.slice(0,-1).join("-"),c=t.turn.steps[s],u=c.LINKS.marks[i]||c.LINKS.commands[i];return e.instruction[u](r)}function w(e,t,n,a){if(t.gameEndedBy)return t;if("endTurn"===n)return v(e,t);if("undo"===n)return function(e){return O(O({},e),{},{state:e.state.undo.state})}(t);if("mark"===n)return function(e,t,n){var a=t.state,i=t.turn.steps;if(a.markStamps[n])return h(h({},t),{},{state:a.markStamps[n]});var s=a.currentStepId,c="".concat(s,"-").concat(n);if(!i[c]){var u=i[s];i[c]=e.action[u.LINKS.marks[n]](u,n)}return h(h({},t),{},{state:h(h({},a),{},{currentStepId:c,board:{marks:a.board.marks.concat(n),units:a.board.units,anim:o.o,potentialMarks:Object.keys(i[c].LINKS.marks)},markStamps:h(h({},a.markStamps),{},Object(r.a)({},n,a))})})}(e,t,a);if("command"===n)return function(e,t,n){var r=t.turn.steps,a=t.state,u=a.currentStepId,l=r[u],d="".concat(u,"-").concat(n),f=r[d]||(r[d]=e.action[l.LINKS.commands[n]](l));return i(i({},t),{},{state:i(i({},a),{},{currentStepId:d,undo:{state:a,command:n},entries:a.entries.concat({path:t.path,player:t.player,turn:f.TURN,description:{line:[{player:t.player},{text:" played "},{bold:a.board.marks.length?"".concat(n,"(").concat(a.board.marks.join(", "),")"):n}]},board:{marks:a.board.marks,units:f.UNITDATA,anim:f.anim||o.o,potentialMarks:s}}),board:{marks:s,units:f.UNITDATA,anim:f.anim||o.o,potentialMarks:Object.keys(f.LINKS.marks)},markStamps:c})})}(e,t,a);throw new Error("Unknown battle input: ".concat(n," ").concat(a||""))}var I=function(e,t,n){return"endTurn"===n?w(e,t,"endTurn"):Object(o.v)(n)?w(e,t,"mark",n):w(e,t,"command",n)},k=function(e,t){var n=t.path.slice(),r=t.variantCode,o=e.variants.find((function(e){return e.code===r}));if(!o)throw new Error("Couldnt find ".concat(e.gameId,' variant with code "').concat(r,'"'));var a=A(e,e.setups[o.setup],o),i=0;do{if(a.turnNumber>t.turn)throw new Error("Went past desired turn number");a=P(e,a,t);var s=n.shift();if(void 0===s)throw new Error("Ran out of actions before inflation was complete");var c=S(a),u=c[s];if(!u)throw new Error("Failed to get index ".concat(s," among options ").concat(c.join(",")));a=I(e,a,u),a=P(e,a,t)}while(!E(a,t)&&n.length&&++i<1e3);if(n.length)throw new Error("Actions remain after inflation was completed");if(!E(a,t))throw new Error("Goal not reach after inflation");return a},S=function(e){if(e.gameEndedBy)return[];var t=e.turn.steps[e.state.currentStepId];return Object(o.N)(t)},E=function(e,t){return e.turnNumber>t.turn||(t.ended?!!e.gameEndedBy&&e.winner===t.player:e.turnNumber===t.turn&&e.player===t.player)},P=function(e,t,n){for(var r=S(t),o=0;1===r.length&&!E(t,n)&&++o<1e3;)t=I(e,t,r[0]),r=S(t);return t};function C(e,t,n,r){var o=t.steps[n];if(o.massiveTree)return t.viableStepIds[n]=!0,t;if(o.canAlwaysEnd&&!r)return t.canEnd=!0,t.viableStepIds[n]=!0,t;var a=o.LINKS;if(a.endGame&&(t.canEnd=!0,t.gameEnds[a.endGame].push(n),t.viableStepIds[n]=!0),a.endTurn){var i=function(e,t){var n=t.steps,r=["root"];for(;!t.canEnd&&r.length;){var o=r.shift(),a=n[o],i=a.LINKS;if(i.endTurn||i.endGame||a.canAlwaysEnd)t.canEnd=!0;else for(var s=Object.keys(i.marks).concat(Object.keys(i.commands));!t.canEnd&&s.length;){var c=s.shift(),u=i.marks[c]||i.commands[c],l=o+"-"+c;n[l]||(n[l]=e.action[u](a,c)),r.push(l)}}return t}(e,x(e.action[a.endTurn](o)));t.canEnd=!0,t.viableStepIds[n]=!0,i.canEnd?t.nextTurns[n]=i:(delete a.endTurn,p(o),t.gameEnds.win.push(n))}for(var s=Object.keys(a.marks).concat(Object.keys(a.commands));s.length;){var c=s.shift(),u=n+"-"+c;if(!t.steps[u]){var l=a.marks[c]||a.commands[c];t.steps[u]=e.action[l](o,c)}(t=C(e,t,u,r)).viableStepIds[u]?(t.canEnd=!0,t.viableStepIds[n]=!0):(delete a.marks[c],delete a.commands[c],delete t.steps[u])}return t}function N(e,t){return C(e,t,"root")}function x(e){return{steps:{root:e},nextTurns:{},viableStepIds:{},gameEnds:{win:[],lose:[],draw:[]}}}function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t,n){var r=function(e,t,n){var r=e.newBattle(t,n);return N(e,x(r))}(e,t,n.ruleset),a={marks:[],units:r.steps.root.UNITDATA,anim:o.o,potentialMarks:Object.keys(r.steps.root.LINKS.marks)};return{variant:n,path:[],turn:r,turnNumber:1,player:1,history:[{path:[],player:0,turn:0,description:{line:[{text:"Initial setup"}]},board:B(B({},a),{},{potentialMarks:[]})}],state:{currentStepId:"root",entries:[],markStamps:{},undo:null,board:a}}}var L=n("ODXe"),D=n("X96R");function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e,t){var n=t.turn.steps[t.state.currentStepId],a=Object.keys(n.LINKS.commands);return{player:t.player,winner:t.winner,turnNumber:t.turnNumber,gameId:e.gameId,board:F(F({},t.state.board),{},{units:Object.keys(t.state.board.units).reduce((function(n,o){return F(F({},n),{},Object(r.a)({},o,F(F({},t.state.board.units[o]),{},{icon:D.a[e.gameId].icons[t.state.board.units[o].group]})))}),{}),anim:n.anim||o.o}),endTurn:Boolean(n.LINKS.endTurn||n.LINKS.endGame),commands:Object.entries(e.commands).map((function(e){var t=Object(L.a)(e,2),n=t[0];return[n,F(F({},t[1]),{},{available:a.includes(n)})]})).reduce((function(e,t){var n=Object(L.a)(t,2),o=n[0],a=n[1];return F(F({},e),{},Object(r.a)({},o,a))}),{}),undo:t.state.undo&&t.state.undo.command,instruction:j(e,t)}}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function U(e){var t=e.variants,n=e.setups,r=e.boards;return{gameId:e.gameId,newBattle:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t[0].code,a=t.find((function(e){return e.code===o}));if(!a)throw new Error('Couldnt find variant with code "'.concat(o,'"'));e.setBoard(r[a.board]);var i=A(e,n[a.setup],a);return i},fromSave:function(n){var o=t.find((function(e){return e.code===n.variantCode}));if(!o)throw console.error(n),new Error('Couldnt find variant with code "'.concat(n.variantCode,'" when inflating save'));return e.setBoard(r[o.board]),k(e,n)},performAction:function(t,n,r){return w(e,t,n,r)},getBattleUI:function(t){return R(e,t)},fromFrame:function(t,n){return k(e,K(K({},t),{},{variantCode:n}))},iconMap:e.iconMap,variants:e.variants}}},oa2v:function(e,t){function n(e){return!!e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(n(e)||function(e){return"function"===typeof e.readFloatLE&&"function"===typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}}}]);